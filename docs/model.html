<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 5 章 量化建模与回测：从模型设定到策略验证 | quantmod：从数据获取到策略实战全景指南</title>
  <meta name="description" content="本书全面解析 R 语言 quantmod 包在金融数据分析与交易策略开发中的核心应用。本书从基础数据获取到高级策略回测，通过 200 + 实例代码详解量化全流程，涵盖指标定制、图表可视化、模型构建与绩效评估。附赠策略模板库，助读者快速搭建个性化量化系统，是金融分析师、量化交易者及相关专业学生的必备工具书。" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="第 5 章 量化建模与回测：从模型设定到策略验证 | quantmod：从数据获取到策略实战全景指南" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/cover.jpg" />
  <meta property="og:description" content="本书全面解析 R 语言 quantmod 包在金融数据分析与交易策略开发中的核心应用。本书从基础数据获取到高级策略回测，通过 200 + 实例代码详解量化全流程，涵盖指标定制、图表可视化、模型构建与绩效评估。附赠策略模板库，助读者快速搭建个性化量化系统，是金融分析师、量化交易者及相关专业学生的必备工具书。" />
  <meta name="github-repo" content="dengyihsuo/quantmod-handbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 5 章 量化建模与回测：从模型设定到策略验证 | quantmod：从数据获取到策略实战全景指南" />
  
  <meta name="twitter:description" content="本书全面解析 R 语言 quantmod 包在金融数据分析与交易策略开发中的核心应用。本书从基础数据获取到高级策略回测，通过 200 + 实例代码详解量化全流程，涵盖指标定制、图表可视化、模型构建与绩效评估。附赠策略模板库，助读者快速搭建个性化量化系统，是金融分析师、量化交易者及相关专业学生的必备工具书。" />
  <meta name="twitter:image" content="/images/cover.jpg" />

<meta name="author" content="邓一硕" />


<meta name="date" content="2025-07-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="TTR.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">quantmod：从数据获取到策略实战全景指南</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path=""><a href="#%E5%89%8D%E8%A8%80"><i class="fa fa-check"></i>前言</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1</b> 数据获取指南</a>
<ul>
<li class="chapter" data-level="1.1" data-path="05-model.html"><a href="#%E8%82%A1%E7%A5%A8%E6%97%A5%E4%BA%A4%E6%98%93%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%8C%87%E5%8D%97"><i class="fa fa-check"></i><b>1.1</b> 股票日交易数据获取指南</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="05-model.html"><a href="#%E4%B8%AD%E5%9B%BD%E5%B8%82%E5%9C%BA%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><i class="fa fa-check"></i><b>1.1.1</b> 中国市场数据获取</a></li>
<li class="chapter" data-level="1.1.2" data-path="05-model.html"><a href="#%E8%8E%B7%E5%8F%96%E7%BE%8E%E5%9B%BD%E5%B8%82%E5%9C%BA%E6%95%B0%E6%8D%AE"><i class="fa fa-check"></i><b>1.1.2</b> 获取美国市场数据</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="05-model.html"><a href="#%E4%BA%A4%E6%98%93%E6%95%B0%E6%8D%AE%E7%9A%84%E7%AE%A1%E7%90%86%E4%B8%8E%E9%87%8D%E5%91%BD%E5%90%8D"><i class="fa fa-check"></i><b>1.2</b> 交易数据的管理与重命名</a></li>
<li class="chapter" data-level="1.3" data-path="05-model.html"><a href="#%E8%82%A1%E6%81%AF%E4%B8%8E%E6%8B%86%E8%82%A1%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%8C%87%E5%8D%97"><i class="fa fa-check"></i><b>1.3</b> 股息与拆股数据获取指南</a></li>
<li class="chapter" data-level="1.4" data-path="05-model.html"><a href="#%E6%9C%9F%E6%9D%83%E4%BA%A4%E6%98%93%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E5%8F%96%E6%8C%87%E5%8D%97"><i class="fa fa-check"></i><b>1.4</b> 期权交易数据获取取指南</a></li>
<li class="chapter" data-level="1.5" data-path="05-model.html"><a href="#%E6%B1%87%E5%B8%82%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%8C%87%E5%8D%97"><i class="fa fa-check"></i><b>1.5</b> 汇市数据获取指南</a></li>
<li class="chapter" data-level="1.6" data-path="05-model.html"><a href="#%E8%B4%B5%E9%87%8D%E9%87%91%E5%B1%9E%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%8C%87%E5%8D%97"><i class="fa fa-check"></i><b>1.6</b> 贵重金属数据获取指南</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="05-model.html"><a href="#%E9%BB%84%E9%87%91%E4%BB%B7%E6%A0%BC%E8%8E%B7%E5%8F%96"><i class="fa fa-check"></i><b>1.6.1</b> 黄金价格获取</a></li>
<li class="chapter" data-level="1.6.2" data-path="05-model.html"><a href="#%E9%92%AF%E9%87%91%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><i class="fa fa-check"></i><b>1.6.2</b> 钯金数据获取</a></li>
<li class="chapter" data-level="1.6.3" data-path="05-model.html"><a href="#%E9%93%82%E9%87%91%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><i class="fa fa-check"></i><b>1.6.3</b> 铂金数据获取</a></li>
<li class="chapter" data-level="1.6.4" data-path="05-model.html"><a href="#%E6%89%B9%E9%87%8F%E8%8E%B7%E5%8F%96%E5%A4%9A%E7%A7%8D%E8%B4%B5%E9%87%91%E5%B1%9E%E6%95%B0%E6%8D%AE"><i class="fa fa-check"></i><b>1.6.4</b> 批量获取多种贵金属数据</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="05-model.html"><a href="#%E7%BE%8E%E8%81%94%E5%82%A8%E7%BB%8F%E6%B5%8E%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%8C%87%E5%8D%97"><i class="fa fa-check"></i><b>1.7</b> 美联储经济数据获取指南</a></li>
<li class="chapter" data-level="1.8" data-path="05-model.html"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%8C%87%E5%8D%97"><i class="fa fa-check"></i><b>1.8</b> 数据库数据获取指南</a></li>
<li class="chapter" data-level="1.9" data-path="05-model.html"><a href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E7%A7%BB%E9%99%A4%E6%95%B0%E6%8D%AE"><i class="fa fa-check"></i><b>1.9</b> 查看和移除数据</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="05-model.html"><a href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE"><i class="fa fa-check"></i><b>1.9.1</b> 查看数据</a></li>
<li class="chapter" data-level="1.9.2" data-path="05-model.html"><a href="#%E7%A7%BB%E9%99%A4%E6%95%B0%E6%8D%AE"><i class="fa fa-check"></i><b>1.9.2</b> 移除数据</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="manipulation.html"><a href="manipulation.html"><i class="fa fa-check"></i><b>2</b> 基本数据操作</a>
<ul>
<li class="chapter" data-level="2.1" data-path="05-model.html"><a href="#%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E7%9A%84%E5%87%BD%E6%95%B0"><i class="fa fa-check"></i><b>2.1</b> 验证数据的函数</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="05-model.html"><a href="#%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><i class="fa fa-check"></i><b>2.1.1</b> 验证数据类型</a></li>
<li class="chapter" data-level="2.1.2" data-path="05-model.html"><a href="#%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7"><i class="fa fa-check"></i><b>2.1.2</b> 验证数据完整性</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="05-model.html"><a href="#%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE"><i class="fa fa-check"></i><b>2.2</b> 提取数据</a></li>
<li class="chapter" data-level="2.3" data-path="05-model.html"><a href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%A1%E7%AE%97"><i class="fa fa-check"></i><b>2.3</b> 数据的简单计算</a></li>
<li class="chapter" data-level="2.4" data-path="05-model.html"><a href="#%E5%BA%8F%E5%88%97%E8%AE%A1%E7%AE%97%E5%87%BD%E6%95%B0"><i class="fa fa-check"></i><b>2.4</b> 序列计算函数</a></li>
<li class="chapter" data-level="2.5" data-path="05-model.html"><a href="#%E8%AE%A1%E7%AE%97%E6%94%B6%E7%9B%8A%E7%8E%87"><i class="fa fa-check"></i><b>2.5</b> 计算收益率</a></li>
<li class="chapter" data-level="2.6" data-path="05-model.html"><a href="#%E5%BA%8F%E5%88%97%E7%9A%84%E6%BB%9E%E5%90%8E%E5%89%8D%E7%A7%BB%E4%B8%8E%E9%80%89%E5%8F%96"><i class="fa fa-check"></i><b>2.6</b> 序列的滞后/前移与选取</a></li>
<li class="chapter" data-level="2.7" data-path="05-model.html"><a href="#%E8%AE%A1%E7%AE%97%E5%B3%B0%E5%80%BC%E5%B3%B0%E8%B0%B7"><i class="fa fa-check"></i><b>2.7</b> 计算峰值/峰谷</a></li>
<li class="chapter" data-level="2.8" data-path="05-model.html"><a href="#%E8%AE%A1%E7%AE%97%E6%9E%81%E5%80%BC"><i class="fa fa-check"></i><b>2.8</b> 计算极值</a></li>
<li class="chapter" data-level="2.9" data-path="05-model.html"><a href="#%E5%B7%AE%E5%88%86%E9%98%88%E5%80%BC%E5%87%BD%E6%95%B0"><i class="fa fa-check"></i><b>2.9</b> 差分/阈值函数</a></li>
<li class="chapter" data-level="2.10" data-path="05-model.html"><a href="#%E6%97%A5%E6%9C%9F%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><i class="fa fa-check"></i><b>2.10</b> 日期转换函数</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="05-model.html"><a href="#%E6%97%A5%E5%91%A8%E8%BD%AC%E6%8D%A2%E5%8F%8A%E6%97%A5%E6%9C%88%E8%BD%AC%E6%8D%A2"><i class="fa fa-check"></i><b>2.10.1</b> 日/周转换及日/月转换</a></li>
<li class="chapter" data-level="2.10.2" data-path="05-model.html"><a href="#%E6%95%B0%E6%8D%AE%E5%91%A8%E6%9C%9F%E7%9A%84%E6%99%BA%E8%83%BD%E8%AF%86%E5%88%AB"><i class="fa fa-check"></i><b>2.10.2</b> 数据周期的智能识别</a></li>
<li class="chapter" data-level="2.10.3" data-path="05-model.html"><a href="#%E5%91%A8%E6%9C%9F%E7%89%B9%E5%BE%81%E8%AE%A1%E7%AE%97"><i class="fa fa-check"></i><b>2.10.3</b> 周期特征计算</a></li>
<li class="chapter" data-level="2.10.4" data-path="05-model.html"><a href="#%E8%AE%A1%E7%AE%97%E5%91%A8%E6%9C%9F%E6%9C%80%E5%A4%A7%E5%80%BC"><i class="fa fa-check"></i><b>2.10.4</b> 计算周期最大值</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>3</b> 图形分析</a>
<ul>
<li class="chapter" data-level="3.1" data-path="05-model.html"><a href="#%E5%9F%BA%E6%9C%AC%E7%BB%98%E5%9B%BE%E5%87%BD%E6%95%B0"><i class="fa fa-check"></i><b>3.1</b> 基本绘图函数</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="05-model.html"><a href="#%E5%85%A8%E8%83%BD%E7%BB%98%E5%9B%BE%E5%BC%95%E6%93%8E-chartseries"><i class="fa fa-check"></i><b>3.1.1</b> 全能绘图引擎 chartSeries</a></li>
<li class="chapter" data-level="3.1.2" data-path="05-model.html"><a href="#%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7-rechart"><i class="fa fa-check"></i><b>3.1.2</b> 动态更新的可视化效率工具 reChart</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="05-model.html"><a href="#%E4%B8%89%E7%A7%8D%E5%9F%BA%E6%9C%AC%E5%9B%BE%E5%BD%A2"><i class="fa fa-check"></i><b>3.2</b> 三种基本图形</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="05-model.html"><a href="#%E6%9D%A1%E5%BD%A2%E5%9B%BE"><i class="fa fa-check"></i><b>3.2.1</b> 条形图</a></li>
<li class="chapter" data-level="3.2.2" data-path="05-model.html"><a href="#%E8%9C%A1%E7%83%9B%E5%9B%BE"><i class="fa fa-check"></i><b>3.2.2</b> 蜡烛图</a></li>
<li class="chapter" data-level="3.2.3" data-path="05-model.html"><a href="#%E7%BA%BF%E5%9B%BE"><i class="fa fa-check"></i><b>3.2.3</b> 线图</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="05-model.html"><a href="#%E5%9B%BE%E5%BD%A2%E4%B8%BB%E9%A2%98%E5%AE%9A%E5%88%B6"><i class="fa fa-check"></i><b>3.3</b> 图形主题定制</a></li>
<li class="chapter" data-level="3.4" data-path="05-model.html"><a href="#%E5%9B%BE%E5%BD%A2%E7%BC%A9%E6%94%BE"><i class="fa fa-check"></i><b>3.4</b> 图形缩放</a></li>
<li class="chapter" data-level="3.5" data-path="05-model.html"><a href="#%E5%9B%BE%E5%BD%A2%E5%AD%98%E5%82%A8"><i class="fa fa-check"></i><b>3.5</b> 图形存储</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="TTR.html"><a href="TTR.html"><i class="fa fa-check"></i><b>4</b> 技术分析图</a>
<ul>
<li class="chapter" data-level="4.1" data-path="05-model.html"><a href="#%E8%B6%8B%E5%8A%BF%E7%B1%BB%E6%8C%87%E6%A0%87%E5%9B%BE"><i class="fa fa-check"></i><b>4.1</b> 趋势类指标图</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="05-model.html"><a href="#%E6%8A%9B%E7%89%A9%E7%BA%BF%E6%8C%87%E6%A0%87-sar%E8%B6%8B%E5%8A%BF%E8%B7%9F%E8%B8%AA%E4%B8%8E%E6%AD%A2%E6%8D%9F%E7%AD%96%E7%95%A5%E7%9A%84%E5%8A%A8%E6%80%81%E5%B9%B3%E8%A1%A1%E5%99%A8"><i class="fa fa-check"></i><b>4.1.1</b> 抛物线指标 SAR：趋势跟踪与止损策略的动态平衡器</a></li>
<li class="chapter" data-level="4.1.2" data-path="05-model.html"><a href="#%E5%B9%B3%E5%9D%87%E8%B6%8B%E5%90%91%E6%8C%87%E6%A0%87-adx%E8%B6%8B%E5%8A%BF%E5%BC%BA%E5%BA%A6%E7%9A%84%E7%B2%BE%E7%A1%AE%E5%BA%A6%E9%87%8F%E4%B8%8E%E4%BA%A4%E6%98%93%E6%97%B6%E6%9C%BA%E8%BF%87%E6%BB%A4%E5%99%A8"><i class="fa fa-check"></i><b>4.1.2</b> 平均趋向指标 ADX：趋势强度的精确度量与交易时机过滤器</a></li>
<li class="chapter" data-level="4.1.3" data-path="05-model.html"><a href="#%E7%AE%80%E5%8D%95%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E7%BA%BF-sma%E8%B6%8B%E5%8A%BF%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8A%A8%E6%80%81%E6%94%AF%E6%92%91%E9%98%BB%E5%8A%9B%E7%9A%84%E5%9F%BA%E7%9F%B3"><i class="fa fa-check"></i><b>4.1.3</b> 简单移动平均线 SMA：趋势识别与动态支撑阻力的基石</a></li>
<li class="chapter" data-level="4.1.4" data-path="05-model.html"><a href="#%E6%8C%87%E6%95%B0%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E7%BA%BF-ema%E4%BB%B7%E6%A0%BC%E5%8A%A8%E9%87%8F%E7%9A%84%E7%81%B5%E6%95%8F%E6%8D%95%E6%8D%89%E5%99%A8%E4%B8%8E%E8%B6%8B%E5%8A%BF%E6%8B%90%E7%82%B9%E5%85%88%E8%A1%8C%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.1.4</b> 指数移动平均线 EMA：价格动量的灵敏捕捉器与趋势拐点先行指标</a></li>
<li class="chapter" data-level="4.1.5" data-path="05-model.html"><a href="#%E5%8F%8C%E6%8C%87%E6%95%B0%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E7%BA%BF-dema%E6%B6%88%E9%99%A4%E6%BB%9E%E5%90%8E%E7%9A%84%E8%B6%8B%E5%8A%BF%E5%8A%A0%E9%80%9F%E5%BC%95%E6%93%8E%E4%B8%8E%E6%8B%90%E7%82%B9%E7%A1%AE%E8%AE%A4%E5%88%A9%E5%99%A8"><i class="fa fa-check"></i><b>4.1.5</b> 双指数移动平均线 DEMA：消除滞后的趋势加速引擎与拐点确认利器</a></li>
<li class="chapter" data-level="4.1.6" data-path="05-model.html"><a href="#%E5%8A%A0%E6%9D%83%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E7%BA%BF-wma%E7%B2%BE%E7%BB%86%E4%BB%B7%E6%A0%BC%E6%9D%83%E9%87%8D%E5%88%86%E9%85%8D%E7%9A%84%E8%B6%8B%E5%8A%BF%E5%BA%A6%E9%87%8F%E8%A1%A1%E4%B8%8E%E7%9F%AD%E6%9C%9F%E6%B3%A2%E5%8A%A8%E8%BF%87%E6%BB%A4%E5%99%A8"><i class="fa fa-check"></i><b>4.1.6</b> 加权移动平均线 WMA：精细价格权重分配的趋势度量衡与短期波动过滤器</a></li>
<li class="chapter" data-level="4.1.7" data-path="05-model.html"><a href="#%E9%9B%B6%E6%BB%9E%E5%90%8E%E6%8C%87%E6%95%B0%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E7%BA%BF-zlema%E6%B6%88%E9%99%A4%E8%B6%8B%E5%8A%BF%E6%BB%9E%E5%90%8E%E7%9A%84%E7%9F%AD%E7%BA%BF%E4%BA%A4%E6%98%93%E5%88%A9%E5%99%A8"><i class="fa fa-check"></i><b>4.1.7</b> 零滞后指数移动平均线 ZLEMA：消除趋势滞后的短线交易利器</a></li>
<li class="chapter" data-level="4.1.8" data-path="05-model.html"><a href="#%E5%BC%B9%E6%80%A7%E6%88%90%E4%BA%A4%E9%87%8F%E5%8A%A0%E6%9D%83%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E7%BA%BF-evwma%E9%87%8F%E4%BB%B7%E7%BB%93%E5%90%88%E7%9A%84%E8%B6%8B%E5%8A%BF%E7%A1%AE%E8%AE%A4%E5%88%A9%E5%99%A8"><i class="fa fa-check"></i><b>4.1.8</b> 弹性成交量加权移动平均线 EVWMA：量价结合的趋势确认利器</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="05-model.html"><a href="#%E9%9C%87%E8%8D%A1%E7%B1%BB%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.2</b> 震荡类指标</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="05-model.html"><a href="#%E7%9B%B8%E5%AF%B9%E5%BC%BA%E5%BC%B1%E6%8C%87%E6%A0%87-rsi%E5%B8%82%E5%9C%BA%E5%8A%A8%E9%87%8F%E7%9A%84%E5%9D%87%E8%A1%A1%E5%A4%A9%E5%B9%B3"><i class="fa fa-check"></i><b>4.2.1</b> 相对强弱指标 RSI：市场动量的均衡天平</a></li>
<li class="chapter" data-level="4.2.2" data-path="05-model.html"><a href="#%E9%9A%8F%E6%9C%BA%E6%8C%87%E6%A0%87-kdj%E4%BB%B7%E6%A0%BC%E5%8A%A8%E9%87%8F%E7%9A%84%E7%B2%BE%E5%87%86%E5%BA%A6%E9%87%8F%E8%A1%A1"><i class="fa fa-check"></i><b>4.2.2</b> 随机指标 KDJ：价格动量的精准度量衡</a></li>
<li class="chapter" data-level="4.2.3" data-path="05-model.html"><a href="#%E5%A8%81%E5%BB%89%E6%8C%87%E6%A0%87-wpr%E5%8F%8D%E5%90%91%E8%A7%86%E8%A7%92%E4%B8%8B%E7%9A%84%E8%B6%85%E4%B9%B0%E8%B6%85%E5%8D%96%E6%8E%A2%E6%B5%8B%E5%99%A8"><i class="fa fa-check"></i><b>4.2.3</b> 威廉指标 WPR：反向视角下的超买超卖探测器</a></li>
<li class="chapter" data-level="4.2.4" data-path="05-model.html"><a href="#chande-%E5%8A%A8%E9%87%8F%E6%91%86%E5%8A%A8%E6%8C%87%E6%A0%87-cmo%E4%BB%B7%E6%A0%BC%E5%8A%A8%E8%83%BD%E7%9A%84%E7%B2%BE%E7%A1%AE%E6%B5%8B%E9%87%8F%E4%BB%AA"><i class="fa fa-check"></i><b>4.2.4</b> Chande 动量摆动指标 CMO：价格动能的精确测量仪</a></li>
<li class="chapter" data-level="4.2.5" data-path="05-model.html"><a href="#%E9%9A%8F%E6%9C%BA%E5%8A%A8%E9%87%8F%E6%8C%87%E6%A0%87-smi%E7%B2%BE%E5%87%86%E8%BF%87%E6%BB%A4%E5%99%AA%E9%9F%B3%E7%9A%84%E8%B6%8B%E5%8A%BF%E5%8F%8D%E8%BD%AC%E6%8E%A2%E6%B5%8B%E5%99%A8"><i class="fa fa-check"></i><b>4.2.5</b> 随机动量指标 SMI：精准过滤噪音的趋势反转探测器</a></li>
<li class="chapter" data-level="4.2.6" data-path="05-model.html"><a href="#%E4%BB%B7%E6%A0%BC%E5%8F%98%E5%8A%A8%E7%8E%87%E6%8C%87%E6%A0%87-roc%E5%B8%82%E5%9C%BA%E5%8A%A8%E8%83%BD%E7%9A%84%E6%B5%8B%E9%80%9F%E4%BB%AA"><i class="fa fa-check"></i><b>4.2.6</b> 价格变动率指标 ROC：市场动能的测速仪</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="05-model.html"><a href="#%E6%B3%A2%E5%8A%A8%E7%8E%87%E7%B1%BB%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.3</b> 波动率类指标</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="05-model.html"><a href="#%E5%B8%83%E6%9E%97%E5%B8%A6-bbands%E5%B8%82%E5%9C%BA%E6%B3%A2%E5%8A%A8%E7%9A%84%E5%8A%A8%E6%80%81%E6%A0%87%E5%B0%BA"><i class="fa fa-check"></i><b>4.3.1</b> 布林带 BBands：市场波动的动态标尺</a></li>
<li class="chapter" data-level="4.3.2" data-path="05-model.html"><a href="#%E5%8C%85%E7%BB%9C%E7%BA%BF-envelope%E4%BB%B7%E6%A0%BC%E6%B3%A2%E5%8A%A8%E7%9A%84%E5%9B%BA%E5%AE%9A%E5%8C%BA%E9%97%B4%E6%A0%87%E5%B0%BA"><i class="fa fa-check"></i><b>4.3.2</b> 包络线 Envelope：价格波动的固定区间标尺</a></li>
<li class="chapter" data-level="4.3.3" data-path="05-model.html"><a href="#%E5%B9%B3%E5%9D%87%E7%9C%9F%E5%AE%9E%E6%B3%A2%E5%B9%85-atr%E5%B8%82%E5%9C%BA%E6%B3%A2%E5%8A%A8%E6%80%A7%E7%9A%84%E7%B2%BE%E5%87%86%E5%BA%A6%E9%87%8F"><i class="fa fa-check"></i><b>4.3.3</b> 平均真实波幅 ATR：市场波动性的精准度量</a></li>
<li class="chapter" data-level="4.3.4" data-path="05-model.html"><a href="#%E5%8C%BA%E9%97%B4%E9%9C%87%E8%8D%A1%E7%BA%BF-dpo%E4%BB%B7%E6%A0%BC%E5%91%A8%E6%9C%9F%E4%B8%8E%E8%B6%85%E4%B9%B0%E8%B6%85%E5%8D%96%E7%9A%84%E7%B2%BE%E5%87%86%E5%BA%A6%E9%87%8F"><i class="fa fa-check"></i><b>4.3.4</b> 区间震荡线 DPO：价格周期与超买超卖的精准度量</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="05-model.html"><a href="#%E6%88%90%E4%BA%A4%E9%87%8F%E7%B1%BB%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.4</b> 成交量类指标</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="05-model.html"><a href="#%E6%88%90%E4%BA%A4%E9%87%8F%E6%8C%87%E6%A0%87-vo%E5%B8%82%E5%9C%BA%E5%8A%A8%E8%83%BD%E4%B8%8E%E8%B6%8B%E5%8A%BF%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%A0%B8%E5%BF%83%E5%B7%A5%E5%85%B7"><i class="fa fa-check"></i><b>4.4.1</b> 成交量指标 Vo：市场动能与趋势确认的核心工具</a></li>
<li class="chapter" data-level="4.4.2" data-path="05-model.html"><a href="#chaikin-%E8%B5%84%E9%87%91%E6%B5%81%E9%87%8F-cmf%E9%87%8F%E4%BB%B7%E7%BB%93%E5%90%88%E7%9A%84%E8%B5%84%E9%87%91%E5%8A%A8%E8%83%BD%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.4.2</b> Chaikin 资金流量 CMF：量价结合的资金动能指标</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="05-model.html"><a href="#%E7%89%B9%E6%AE%8A%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.5</b> 特殊技术指标</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="05-model.html"><a href="#%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E6%94%B6%E6%95%9B%E5%8F%91%E6%95%A3%E6%8C%87%E6%A0%87-macd%E8%B6%8B%E5%8A%BF%E4%B8%8E%E5%8A%A8%E9%87%8F%E7%9A%84%E5%8F%8C%E9%87%8D%E5%BA%A6%E9%87%8F"><i class="fa fa-check"></i><b>4.5.1</b> 移动平均收敛发散指标 MACD：趋势与动量的双重度量</a></li>
<li class="chapter" data-level="4.5.2" data-path="05-model.html"><a href="#%E5%8A%A8%E9%87%8F%E6%8C%87%E6%A0%87-momentum%E4%BB%B7%E6%A0%BC%E5%8F%98%E5%8A%A8%E9%80%9F%E5%BA%A6%E7%9A%84%E7%B2%BE%E5%87%86%E5%BA%A6%E9%87%8F"><i class="fa fa-check"></i><b>4.5.2</b> 动量指标 Momentum：价格变动速度的精准度量</a></li>
<li class="chapter" data-level="4.5.3" data-path="05-model.html"><a href="#%E9%A1%BA%E5%8A%BF%E6%8C%87%E6%A0%87-cci%E4%BB%B7%E6%A0%BC%E5%81%8F%E7%A6%BB%E5%BA%A6%E4%B8%8E%E8%B6%8B%E5%8A%BF%E5%8F%8D%E8%BD%AC%E7%9A%84%E5%8A%A8%E6%80%81%E7%9B%91%E6%B5%8B"><i class="fa fa-check"></i><b>4.5.3</b> 顺势指标 CCI：价格偏离度与趋势反转的动态监测</a></li>
<li class="chapter" data-level="4.5.4" data-path="05-model.html"><a href="#%E5%90%88%E7%BA%A6%E7%BB%88%E6%AD%A2%E7%BA%BF-expiry%E6%9C%9F%E8%B4%A7%E5%B8%82%E5%9C%BA%E6%97%B6%E9%97%B4%E7%BB%B4%E5%BA%A6%E7%9A%84%E9%A3%8E%E9%99%A9%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><i class="fa fa-check"></i><b>4.5.4</b> 合约终止线 Expiry：期货市场时间维度的风险管理工具</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="05-model.html"><a href="#%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0quantmod-%E5%8C%85%E7%9A%84%E6%8C%87%E6%A0%87%E5%AE%9A%E5%88%B6%E4%B8%8E%E5%9B%BE%E8%A1%A8%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><i class="fa fa-check"></i><b>4.6</b> 辅助函数：quantmod 包的指标定制与图表管理工具</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="05-model.html"><a href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E7%BB%98%E5%9B%BE%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.6.1</b> 设置默认绘图指标</a></li>
<li class="chapter" data-level="4.6.2" data-path="05-model.html"><a href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.6.2</b> 添加自定义指标</a></li>
<li class="chapter" data-level="4.6.3" data-path="05-model.html"><a href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.6.3</b> 创建新指标</a></li>
<li class="chapter" data-level="4.6.4" data-path="05-model.html"><a href="#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E6%B7%BB%E5%8A%A0%E7%9A%84%E6%8C%87%E6%A0%87"><i class="fa fa-check"></i><b>4.6.4</b> 查看已添加的指标</a></li>
<li class="chapter" data-level="4.6.5" data-path="05-model.html"><a href="#%E6%9E%84%E5%BB%BA%E7%BB%BC%E5%90%88%E5%88%86%E6%9E%90%E5%9B%BE%E8%A1%A8"><i class="fa fa-check"></i><b>4.6.5</b> 构建综合分析图表</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="model.html"><a href="model.html"><i class="fa fa-check"></i><b>5</b> 量化建模与回测：从模型设定到策略验证</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05-model.html"><a href="#%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B"><i class="fa fa-check"></i><b>5.1</b> 模型构建流程</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="05-model.html"><a href="#%E8%AE%BE%E5%AE%9A%E6%A8%A1%E5%9E%8B%E5%BD%A2%E5%BC%8F"><i class="fa fa-check"></i><b>5.1.1</b> 设定模型形式</a></li>
<li class="chapter" data-level="5.1.2" data-path="05-model.html"><a href="#%E6%9F%A5%E7%9C%8B%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE"><i class="fa fa-check"></i><b>5.1.2</b> 查看模型数据</a></li>
<li class="chapter" data-level="5.1.3" data-path="05-model.html"><a href="#%E4%BC%B0%E8%AE%A1%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0"><i class="fa fa-check"></i><b>5.1.3</b> 估计模型参数</a></li>
<li class="chapter" data-level="5.1.4" data-path="05-model.html"><a href="#%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%9C%E6%8F%90%E5%8F%96"><i class="fa fa-check"></i><b>5.1.4</b> 模型结果提取</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="05-model.html"><a href="#%E7%AD%96%E7%95%A5%E5%9B%9E%E6%B5%8B%E4%B8%8E%E8%AF%84%E4%BC%B0"><i class="fa fa-check"></i><b>5.2</b> 策略回测与评估</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i>结语</a></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="quantbooks.html"><a href="quantbooks.html"><i class="fa fa-check"></i><b>A</b> R 量化投资系列书籍</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://gewutang.org" target="blank">本书由邓一硕出品</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">quantmod：从数据获取到策略实战全景指南</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">第 5 章</span> 量化建模与回测：从模型设定到策略验证<a href="model.html#model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>quantmod 包为金融数据统计建模提供了流畅且模块化的操作框架，其工作流程可概括为从模型构建、参数估计到策略回测的完整闭环。这种设计使复杂的量化分析任务被拆解为一系列可复用的函数调用，极大提升了分析效率与灵活性。</p>
<div id="模型构建流程" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> 模型构建流程<a href="#%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="设定模型形式" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> 设定模型形式<a href="#%E8%AE%BE%E5%AE%9A%E6%A8%A1%E5%9E%8B%E5%BD%A2%E5%BC%8F" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>模型构建始于对目标变量与解释变量关系的数学表达。通过 specifyModel 函数，用户可以采用类似 R 语言中线性回归的公式语法来定义模型结构。例如，使用 <code>Next(OpCl(AAPL)) ~ Lag(OpHi(AAPL),0:3) + Hi(IXIC)</code>可以构建一个预测苹果公司次日开盘收盘价差的模型。</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="model.html#cb496-1" tabindex="-1"></a><span class="co"># 加载包</span></span>
<span id="cb496-2"><a href="model.html#cb496-2" tabindex="-1"></a><span class="fu">require</span>(quantmod)</span>
<span id="cb496-3"><a href="model.html#cb496-3" tabindex="-1"></a><span class="co"># 下载数据</span></span>
<span id="cb496-4"><a href="model.html#cb496-4" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="fu">c</span>(<span class="st">&quot;^IXIC&quot;</span>,<span class="st">&quot;AAPL&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;IXIC&quot; &quot;AAPL&quot;</code></pre>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="model.html#cb498-1" tabindex="-1"></a><span class="co"># 设定模型形式</span></span>
<span id="cb498-2"><a href="model.html#cb498-2" tabindex="-1"></a>q.model <span class="ot">&lt;-</span> <span class="fu">specifyModel</span>(<span class="fu">Next</span>(<span class="fu">OpCl</span>(AAPL)) <span class="sc">~</span> <span class="fu">Lag</span>(<span class="fu">OpHi</span>(AAPL),<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">Hi</span>(IXIC))</span>
<span id="cb498-3"><a href="model.html#cb498-3" tabindex="-1"></a><span class="co"># 查看模型</span></span>
<span id="cb498-4"><a href="model.html#cb498-4" tabindex="-1"></a>q.model</span></code></pre></div>
<pre><code>## 
## quantmod object:     Build date:   
## 
## Model Specified: 
##      Next(OpCl(AAPL)) ~ Lag(OpHi(AAPL), 0:3) + Hi(IXIC) 
## 
## Model Target:  Next.OpCl.AAPL         Product:  AAPL 
## Model Inputs:   
## 
## Fitted Model: 
## 
##  None Fitted</code></pre>
<p>该模型考虑了苹果公司自身最近4天的开盘最高价差以及纳斯达克综合指数的当日最高价。这种表达不仅清晰定义了变量间的逻辑关系，还通过 Lag 函数灵活引入了时间滞后效应，使模型能够捕捉市场的惯性特征。</p>
</div>
<div id="查看模型数据" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> 查看模型数据<a href="#%E6%9F%A5%E7%9C%8B%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>模型设定完成后，modelData 函数可用于查看模型对应的数据集。这一功能在调试阶段尤为重要，通过观察生成的数据结构，用户可以确认变量计算是否符合预期。</p>
<p>值得注意的是，quantmod 包在处理时间序列数据时会自动处理缺失值和对齐问题，例如通过 na.rm=TRUE 参数可以便捷地移除包含缺失值的样本。</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="model.html#cb500-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">modelData</span>(q.model))</span></code></pre></div>
<pre><code>##            Next.OpCl.AAPL
## 2007-01-08      0.0707922
## 2007-01-09      0.0237467
## 2007-01-10     -0.0014593
## 2007-01-11      0.0003174
## 2007-01-12      0.0148410
## 2007-01-16     -0.0267530
##            Lag.OpHi.AAPL.0.3.Lag.0
## 2007-01-08                0.006631
## 2007-01-09                0.075535
## 2007-01-10                0.032190
## 2007-01-11                0.008755
## 2007-01-12                0.004969
## 2007-01-16                0.016409
##            Lag.OpHi.AAPL.0.3.Lag.1
## 2007-01-08                0.005013
## 2007-01-09                0.006631
## 2007-01-10                0.075535
## 2007-01-11                0.032190
## 2007-01-12                0.008755
## 2007-01-16                0.004969
##            Lag.OpHi.AAPL.0.3.Lag.2
## 2007-01-08                0.022606
## 2007-01-09                0.005013
## 2007-01-10                0.006631
## 2007-01-11                0.075535
## 2007-01-12                0.032190
## 2007-01-16                0.008755
##            Lag.OpHi.AAPL.0.3.Lag.3 Hi.IXIC
## 2007-01-08                0.003361    2446
## 2007-01-09                0.022606    2450
## 2007-01-10                0.005013    2461
## 2007-01-11                0.006631    2489
## 2007-01-12                0.075535    2503
## 2007-01-16                0.032190    2509</code></pre>
<p>若希望直接生成模型数据集，buildData 函数提供了更简洁的方式，但其结果仅用于数据探查，不能直接传递给模型训练函数。</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="model.html#cb502-1" tabindex="-1"></a>bD<span class="ot">=</span><span class="fu">buildData</span>(<span class="fu">Next</span>(<span class="fu">OpCl</span>(AAPL)) <span class="sc">~</span> <span class="fu">Lag</span>(<span class="fu">OpHi</span>(AAPL),<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">Hi</span>(IXIC))</span>
<span id="cb502-2"><a href="model.html#cb502-2" tabindex="-1"></a><span class="fu">head</span>(bD)</span></code></pre></div>
<pre><code>##            Next.OpCl.AAPL
## 2007-01-08      0.0707922
## 2007-01-09      0.0237467
## 2007-01-10     -0.0014593
## 2007-01-11      0.0003174
## 2007-01-12      0.0148410
## 2007-01-16     -0.0267530
##            Lag.OpHi.AAPL.0.3.Lag.0
## 2007-01-08                0.006631
## 2007-01-09                0.075535
## 2007-01-10                0.032190
## 2007-01-11                0.008755
## 2007-01-12                0.004969
## 2007-01-16                0.016409
##            Lag.OpHi.AAPL.0.3.Lag.1
## 2007-01-08                0.005013
## 2007-01-09                0.006631
## 2007-01-10                0.075535
## 2007-01-11                0.032190
## 2007-01-12                0.008755
## 2007-01-16                0.004969
##            Lag.OpHi.AAPL.0.3.Lag.2
## 2007-01-08                0.022606
## 2007-01-09                0.005013
## 2007-01-10                0.006631
## 2007-01-11                0.075535
## 2007-01-12                0.032190
## 2007-01-16                0.008755
##            Lag.OpHi.AAPL.0.3.Lag.3 Hi.IXIC
## 2007-01-08                0.003361    2446
## 2007-01-09                0.022606    2450
## 2007-01-10                0.005013    2461
## 2007-01-11                0.006631    2489
## 2007-01-12                0.075535    2503
## 2007-01-16                0.032190    2509</code></pre>
</div>
<div id="估计模型参数" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> 估计模型参数<a href="#%E4%BC%B0%E8%AE%A1%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>参数估计是模型训练的核心环节。buildModel 函数支持多种建模方法，包括线性回归（lm）、广义线性模型（glm）等。在训练过程中，用户需要指定训练周期，例如 training.per=c(‘2013-08-01’,‘2013-09-30’) 将限定模型仅使用该时间段内的数据进行参数估计。这种时间窗口划分机制使模型能够在历史数据上进行滚动训练，有效评估模型的时间稳定性。训练完成后，通过 print 和 summary 函数可以查看模型的关键统计信息，包括系数估计值、显著性水平以及拟合优度等指标，帮助用户评估模型质量。</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="model.html#cb504-1" tabindex="-1"></a><span class="do">## 简单的线型模型</span></span>
<span id="cb504-2"><a href="model.html#cb504-2" tabindex="-1"></a>bM <span class="ot">&lt;-</span> <span class="fu">buildModel</span>(q.model,<span class="at">method=</span><span class="st">&#39;lm&#39;</span>,<span class="at">training.per=</span><span class="fu">c</span>(<span class="st">&#39;2013-08-01&#39;</span>,<span class="st">&#39;2013-09-30&#39;</span>))</span>
<span id="cb504-3"><a href="model.html#cb504-3" tabindex="-1"></a><span class="do">## 显示结果</span></span>
<span id="cb504-4"><a href="model.html#cb504-4" tabindex="-1"></a><span class="fu">print</span>(bM,<span class="at">width =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## &lt;S4 Type Object&gt;
## attr(,&quot;model.id&quot;)
## [1] &quot;lm1752127392.81813&quot;
## attr(,&quot;model.spec&quot;)
## Next(OpCl(AAPL)) ~ Lag(OpHi(AAPL), 0:3) + Hi(IXIC)
## attr(,&quot;model.formula&quot;)
## Next.OpCl.AAPL ~ Lag.OpHi.AAPL.0.3.Lag.0 + Lag.OpHi.AAPL.0.3.Lag.1 + 
##     Lag.OpHi.AAPL.0.3.Lag.2 + Lag.OpHi.AAPL.0.3.Lag.3 + Hi.IXIC
## &lt;environment: 0x7fe354518a58&gt;
## attr(,&quot;model.target&quot;)
## [1] &quot;Next.OpCl.AAPL&quot;
## attr(,&quot;model.inputs&quot;)
## [1] &quot;Lag.OpHi.AAPL.0.3.Lag.0&quot;
## [2] &quot;Lag.OpHi.AAPL.0.3.Lag.1&quot;
## [3] &quot;Lag.OpHi.AAPL.0.3.Lag.2&quot;
## [4] &quot;Lag.OpHi.AAPL.0.3.Lag.3&quot;
## [5] &quot;Hi.IXIC&quot;                
## attr(,&quot;build.inputs&quot;)
## [1] &quot;Lag.OpHi.AAPL.0.3.Lag.0&quot;
## [2] &quot;Lag.OpHi.AAPL.0.3.Lag.1&quot;
## [3] &quot;Lag.OpHi.AAPL.0.3.Lag.2&quot;
## [4] &quot;Lag.OpHi.AAPL.0.3.Lag.3&quot;
## [5] &quot;Hi.IXIC&quot;                
## attr(,&quot;symbols&quot;)
## [1] &quot;AAPL&quot; &quot;IXIC&quot;
## attr(,&quot;product&quot;)
## [1] &quot;AAPL&quot;
## attr(,&quot;price.levels&quot;)
## `\001NULL\001`
## attr(,&quot;training.data&quot;)
##  [1] &quot;2013-08-01&quot; &quot;2013-08-02&quot; &quot;2013-08-05&quot;
##  [4] &quot;2013-08-06&quot; &quot;2013-08-07&quot; &quot;2013-08-08&quot;
##  [7] &quot;2013-08-09&quot; &quot;2013-08-12&quot; &quot;2013-08-13&quot;
## [10] &quot;2013-08-14&quot; &quot;2013-08-15&quot; &quot;2013-08-16&quot;
## [13] &quot;2013-08-19&quot; &quot;2013-08-20&quot; &quot;2013-08-21&quot;
## [16] &quot;2013-08-22&quot; &quot;2013-08-23&quot; &quot;2013-08-26&quot;
## [19] &quot;2013-08-27&quot; &quot;2013-08-28&quot; &quot;2013-08-29&quot;
## [22] &quot;2013-08-30&quot; &quot;2013-09-03&quot; &quot;2013-09-04&quot;
## [25] &quot;2013-09-05&quot; &quot;2013-09-06&quot; &quot;2013-09-09&quot;
## [28] &quot;2013-09-10&quot; &quot;2013-09-11&quot; &quot;2013-09-12&quot;
## [31] &quot;2013-09-13&quot; &quot;2013-09-16&quot; &quot;2013-09-17&quot;
## [34] &quot;2013-09-18&quot; &quot;2013-09-19&quot; &quot;2013-09-20&quot;
## [37] &quot;2013-09-23&quot; &quot;2013-09-24&quot; &quot;2013-09-25&quot;
## [40] &quot;2013-09-26&quot; &quot;2013-09-27&quot; &quot;2013-09-30&quot;
## attr(,&quot;build.date&quot;)
## [1] &quot;2025-07-10 14:03:12.817975&quot;
## attr(,&quot;fitted.model&quot;)
## 
## Call:
## lm(formula = quantmod@model.formula, data = training.data)
## 
## Coefficients:
##             (Intercept)  
##                6.36e-02  
## Lag.OpHi.AAPL.0.3.Lag.0  
##                2.01e-01  
## Lag.OpHi.AAPL.0.3.Lag.1  
##               -8.97e-02  
## Lag.OpHi.AAPL.0.3.Lag.2  
##               -1.06e-01  
## Lag.OpHi.AAPL.0.3.Lag.3  
##                7.86e-02  
##                 Hi.IXIC  
##               -1.77e-05  
## 
## attr(,&quot;model.data&quot;)
##            Next.OpCl.AAPL Lag.OpHi.AAPL.0.3.Lag.0
## 2007-01-08      0.0707922               0.0066310
## 2007-01-09      0.0237467               0.0755349
## 2007-01-10     -0.0014593               0.0321898
## 2007-01-11      0.0003174               0.0087555
## 2007-01-12      0.0148410               0.0049689
## 2007-01-16     -0.0267530               0.0164087
## 2007-01-17     -0.0328992               0.0004098
## 2007-01-18     -0.0014669               0.0001086
## 2007-01-19     -0.0263629               0.0115086
## 2007-01-22     -0.0003501               0.0002246
##        ...                                       
## 2025-06-25     -0.0021347               0.0110201
## 2025-06-26     -0.0040121               0.0060071
## 2025-06-27      0.0156428               0.0065878
## 2025-06-30      0.0055645               0.0266324
## 2025-07-01      0.0168972               0.0170320
## 2025-07-02      0.0065991               0.0212053
## 2025-07-03     -0.0128362               0.0117841
## 2025-07-07     -0.0004284               0.0166918
## 2025-07-08      0.0076839               0.0063303
## 2025-07-09             NA               0.0085907
##            Lag.OpHi.AAPL.0.3.Lag.1
## 2007-01-08               0.0050134
## 2007-01-09               0.0066310
## 2007-01-10               0.0755349
## 2007-01-11               0.0321898
## 2007-01-12               0.0087555
## 2007-01-16               0.0049689
## 2007-01-17               0.0164087
## 2007-01-18               0.0004098
## 2007-01-19               0.0001086
## 2007-01-22               0.0115086
##        ...                        
## 2025-06-25               0.0041957
## 2025-06-26               0.0110201
## 2025-06-27               0.0060071
## 2025-06-30               0.0065878
## 2025-07-01               0.0266324
## 2025-07-02               0.0170320
## 2025-07-03               0.0212053
## 2025-07-07               0.0117841
## 2025-07-08               0.0166918
## 2025-07-09               0.0063303
##            Lag.OpHi.AAPL.0.3.Lag.2
## 2007-01-08               0.0226056
## 2007-01-09               0.0050134
## 2007-01-10               0.0066310
## 2007-01-11               0.0755349
## 2007-01-12               0.0321898
## 2007-01-16               0.0087555
## 2007-01-17               0.0049689
## 2007-01-18               0.0164087
## 2007-01-19               0.0004098
## 2007-01-22               0.0001086
##        ...                        
## 2025-06-25               0.0033229
## 2025-06-26               0.0041957
## 2025-06-27               0.0110201
## 2025-06-30               0.0060071
## 2025-07-01               0.0065878
## 2025-07-02               0.0266324
## 2025-07-03               0.0170320
## 2025-07-07               0.0212053
## 2025-07-08               0.0117841
## 2025-07-09               0.0166918
##            Lag.OpHi.AAPL.0.3.Lag.3 Hi.IXIC
## 2007-01-08               0.0033608    2446
## 2007-01-09               0.0226056    2450
## 2007-01-10               0.0050134    2461
## 2007-01-11               0.0066310    2489
## 2007-01-12               0.0755349    2503
## 2007-01-16               0.0321898    2509
## 2007-01-17               0.0087555    2497
## 2007-01-18               0.0049689    2476
## 2007-01-19               0.0164087    2454
## 2007-01-22               0.0004098    2455
##        ...                                
## 2025-06-25               0.0174535   20053
## 2025-06-26               0.0033229   20187
## 2025-06-27               0.0041957   20312
## 2025-06-30               0.0110201   20418
## 2025-07-01               0.0060071   20339
## 2025-07-02               0.0065878   20397
## 2025-07-03               0.0266324   20625
## 2025-07-07               0.0170320   20512
## 2025-07-08               0.0212053   20481
## 2025-07-09               0.0117841   20645
## attr(,&quot;quantmod.version&quot;)
## numeric(0)
## attr(,&quot;class&quot;)
## [1] &quot;quantmod&quot;
## attr(,&quot;class&quot;)attr(,&quot;package&quot;)
## [1] &quot;quantmod&quot;</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="model.html#cb506-1" tabindex="-1"></a><span class="co"># 查看更详细的结果</span></span>
<span id="cb506-2"><a href="model.html#cb506-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(bM),<span class="at">width =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## 
## quantmod object:   lm1752127392.81813    Build date:  2025-07-10 14:03:12.817975 
## 
## Model Specified: 
##      Next(OpCl(AAPL)) ~ Lag(OpHi(AAPL), 0:3) + Hi(IXIC) 
## 
## Model Target:  Next.OpCl.AAPL         Product:  AAPL 
## Model Inputs:  Lag.OpHi.AAPL.0.3.Lag.0, Lag.OpHi.AAPL.0.3.Lag.1, Lag.OpHi.AAPL.0.3.Lag.2, Lag.OpHi.AAPL.0.3.Lag.3, Hi.IXIC 
## 
## Fitted Model: 
## 
##  Modelling procedure:  lm 
##  Training window:  42  observations from  2013-08-01 to 2013-09-30
## 
## Call:
## lm(formula = quantmod@model.formula, data = training.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.02207 -0.00766 -0.00028  0.00689  0.03572 
## 
## Coefficients:
##                          Estimate Std. Error
## (Intercept)              6.36e-02   1.40e-01
## Lag.OpHi.AAPL.0.3.Lag.0  2.01e-01   2.28e-01
## Lag.OpHi.AAPL.0.3.Lag.1 -8.97e-02   2.29e-01
## Lag.OpHi.AAPL.0.3.Lag.2 -1.06e-01   2.34e-01
## Lag.OpHi.AAPL.0.3.Lag.3  7.86e-02   2.31e-01
## Hi.IXIC                 -1.77e-05   3.75e-05
##                         t value Pr(&gt;|t|)
## (Intercept)                0.45     0.65
## Lag.OpHi.AAPL.0.3.Lag.0    0.88     0.38
## Lag.OpHi.AAPL.0.3.Lag.1   -0.39     0.70
## Lag.OpHi.AAPL.0.3.Lag.2   -0.46     0.65
## Lag.OpHi.AAPL.0.3.Lag.3    0.34     0.74
## Hi.IXIC                   -0.47     0.64
## 
## Residual standard error: 0.0132 on 36 degrees of freedom
## Multiple R-squared:  0.0391, Adjusted R-squared:  -0.0943 
## F-statistic: 0.293 on 5 and 36 DF,  p-value: 0.914</code></pre>
</div>
<div id="模型结果提取" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> 模型结果提取<a href="#%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%9C%E6%8F%90%E5%8F%96" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>模型结果提取是连接训练与应用的桥梁。getModelData 函数能够从训练好的模型中提取关键数据，如预测值、残差等，这些数据可进一步用于策略构建或风险分析。例如，通过分析模型残差的分布特征，用户可以识别模型未捕捉到的市场异常波动，从而对模型进行改进。</p>
<p>提取前述模型结果：</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="model.html#cb508-1" tabindex="-1"></a><span class="fu">getModelData</span>(bM)</span></code></pre></div>
<pre><code>## 
## quantmod object:   lm1752127392.81813    Build date:  2025-07-10 14:03:12.817975 
## 
## Model Specified: 
##      Next(OpCl(AAPL)) ~ Lag(OpHi(AAPL), 0:3) + Hi(IXIC) 
## 
## Model Target:  Next.OpCl.AAPL         Product:  AAPL 
## Model Inputs:  Lag.OpHi.AAPL.0.3.Lag.0, Lag.OpHi.AAPL.0.3.Lag.1, Lag.OpHi.AAPL.0.3.Lag.2, Lag.OpHi.AAPL.0.3.Lag.3, Hi.IXIC 
## 
## Fitted Model: 
## 
##  Modelling procedure:  lm 
##  Training window:  42  observations from  2013-08-01 to 2013-09-30
## 
## Call:
## lm(formula = quantmod@model.formula, data = training.data)
## 
## Coefficients:
##             (Intercept)  
##                6.36e-02  
## Lag.OpHi.AAPL.0.3.Lag.0  
##                2.01e-01  
## Lag.OpHi.AAPL.0.3.Lag.1  
##               -8.97e-02  
## Lag.OpHi.AAPL.0.3.Lag.2  
##               -1.06e-01  
## Lag.OpHi.AAPL.0.3.Lag.3  
##                7.86e-02  
##                 Hi.IXIC  
##               -1.77e-05</code></pre>
</div>
</div>
<div id="策略回测与评估" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> 策略回测与评估<a href="#%E7%AD%96%E7%95%A5%E5%9B%9E%E6%B5%8B%E4%B8%8E%E8%AF%84%E4%BC%B0" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>策略回测是量化模型落地的关键环节。tradeModel 函数提供了基础的回测功能，能够基于训练好的模型生成交易信号并模拟交易过程。默认情况下，回测采用 1 倍杠杆，但通过 leverage 参数可以灵活调整杠杆水平，例如设置为 2 时将使用 2 倍杠杆进行回测，这有助于评估策略在不同资金管理方案下的表现。回测结果会显示关键绩效指标，如累计收益率、最大回撤等，直观反映策略的盈利能力和风险控制能力。</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="model.html#cb510-1" tabindex="-1"></a><span class="co"># 基础回测</span></span>
<span id="cb510-2"><a href="model.html#cb510-2" tabindex="-1"></a><span class="fu">tradeModel</span>(bM)</span></code></pre></div>
<pre><code>## 
##   Model:  lm1752127392.81813 
## 
##   C.A.G.R.:  -13.24%     H.P.R.:  -97.78% 
## 
##   Returns by period summary:
## 
##              weekly monthly quarterly
##     Max.     11.42%  16.82%    26.20%
##     3rd Qu.   1.58%   2.65%     2.05%
##     Mean     -0.35%  -1.52%    -4.40%
##     Median   -0.37%  -1.44%    -4.15%
##     2rd Qu.  -2.22%  -6.33%   -12.44%
##     Min.    -22.08% -24.44%   -23.94%
##              yearly
##     Max.     60.86%
##     3rd Qu. -12.42%
##     Mean    -15.96%
##     Median  -19.75%
##     2rd Qu. -26.73%
##     Min.    -45.64%
## 
##   Period to date returns:
## 
##              weekly monthly quarterly
##               0.55%  -2.35%    -2.35%
##               yearly
##              -19.28%</code></pre>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="model.html#cb512-1" tabindex="-1"></a><span class="co"># 带杠杆回测</span></span>
<span id="cb512-2"><a href="model.html#cb512-2" tabindex="-1"></a><span class="fu">tradeModel</span>(bM, <span class="at">leverage=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## 
##   Model:  lm1752127392.81813 
## 
##   C.A.G.R.:  -28.12%     H.P.R.:  -99.99% 
## 
##   Returns by period summary:
## 
##              weekly monthly quarterly
##     Max.     23.77%  35.70%    56.36%
##     3rd Qu.   3.08%   4.72%     3.62%
##     Mean     -0.70%  -3.09%    -8.79%
##     Median   -0.80%  -3.10%    -9.71%
##     2rd Qu.  -4.44% -12.48%   -24.67%
##     Min.    -41.26% -45.38%   -43.48%
##              yearly
##     Max.    139.66%
##     3rd Qu. -27.31%
##     Mean    -28.67%
##     Median  -40.87%
##     2rd Qu. -48.21%
##     Min.    -77.62%
## 
##   Period to date returns:
## 
##              weekly monthly quarterly
##               1.08%  -4.70%    -4.70%
##               yearly
##              -39.33%</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="TTR.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": false,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/dengyishuo/quantmod-handbook/05-model.Rmd",
    "text": "编辑"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["QuantmodHandbook.pdf", "QuantmodHandbook.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "none"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
